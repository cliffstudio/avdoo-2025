{"version":3,"file":"formie-widgets.js","sources":["../../src/js/formie-widgets.js"],"sourcesContent":["// CSS needs to be imported here as it's treated as a module\nimport '../scss/formie-widgets.scss';\n\nif (typeof Craft.Formie === typeof undefined) {\n    Craft.Formie = {};\n}\n\nCraft.Formie.ChartColors = {\n    blue: {\n        bg: 'rgba(66,153,225, 0.1)',\n        border: '#4299E1',\n    },\n    cyan: {\n        bg: 'rgba(56, 190, 201, 0.1)',\n        border: 'rgba(56, 190, 201, 0.75)',\n    },\n    orange: {\n        bg: 'rgba(237, 137, 54, 0.1)',\n        border: '#ED8936',\n    },\n    red: {\n        bg: 'rgba(245, 101, 101, 0.1)',\n        border: '#F56565',\n    },\n    green: {\n        bg: 'rgba(72, 187, 120, 0.1)',\n        border: '#48BB78',\n    },\n    purple: {\n        bg: 'rgba(128, 90, 213, 0.1)',\n        border: '#805AD5',\n    },\n    grey: {\n        bg: 'rgb(160, 174, 192, 0.1)',\n        border: '#A0AEC0',\n    },\n\n    gridLines: 'rgba(155, 155, 155, 0.1)',\n    text: 'hsl(209, 18%, 30%)',\n\n    bgColors() {\n        return [\n            this.blue.bg,\n            this.red.bg,\n            this.orange.bg,\n            this.green.bg,\n            this.purple.bg,\n            this.cyan.bg,\n        ];\n    },\n\n    borderColors() {\n        return [\n            this.blue.border,\n            this.red.border,\n            this.orange.border,\n            this.green.border,\n            this.purple.border,\n            this.cyan.border,\n        ];\n    },\n\n    doughnutColors() {\n        return [\n            this.blue.border,\n            this.red.border,\n            this.orange.border,\n            this.green.border,\n            this.purple.border,\n            this.grey.border,\n        ];\n    },\n};\n\nCraft.Formie.ChartCurrencyTicks = function(value, index, values) {\n    return new Intl.NumberFormat(window.formieCurrentLocale, { style: 'currency', currency: window.formieCurrency }).format(value);\n};\n\nCraft.Formie.Chart = Garnish.Base.extend({\n\n    /**\n     * Default options key'd by chart type\n     */\n    defaults: {\n        general: {\n            options: {\n                legend: {\n                    labels: {\n                        boxWidth: 8,\n                        usePointStyle: true,\n                    },\n                    onClick(event, label) {\n                        return false;\n                    },\n                },\n                tooltips: {\n                    bodyFontColor: Craft.Formie.ChartColors.text,\n                    backgroundColor: '#fff',\n                    borderColor: Craft.Formie.ChartColors.gridLines,\n                    borderWidth: 1,\n                    caretPadding: 6,\n                    caretSize: 0,\n                    mode: 'index',\n                    titleFontColor: Craft.Formie.ChartColors.text,\n\n                    enabled: false,\n                    callbacks: {\n                        title(tooltipItems, data) {\n                            var title = '';\n\n                            if (tooltipItems[0].xLabel) {\n                                title = tooltipItems[0].xLabel;\n                                var format = 'MMM D';\n                                var allFirstOfMonth = true;\n\n                                data.labels.forEach((label) => {\n                                    // eslint-disable-next-line\n                                    if (!label.match(/^\\d{4}\\-\\d{2}\\-01$/g)) {\n                                        allFirstOfMonth = false;\n                                    }\n                                });\n\n                                if (allFirstOfMonth) {\n                                    format = 'MMM YYYY';\n                                }\n\n                                title = moment(title).format(format);\n                            }\n\n                            return title;\n                        },\n                        label(tooltipItem, data) {\n                            var label;\n                            if (tooltipItem.yLabel == '') {\n                                label = data.datasets[tooltipItem.datasetIndex].data[tooltipItem.index];\n                            } else {\n                                label = tooltipItem.yLabel;\n                            }\n\n                            if (data.datasets[tooltipItem.datasetIndex].yAxisID && data.datasets[tooltipItem.datasetIndex].yAxisID == 'revenue') {\n                                label = Craft.Formie.ChartCurrencyTicks(label, 0, []);\n                            } else {\n                                label = Craft.formatNumber(label);\n                            }\n\n                            return label;\n                        },\n                    },\n                    custom(tooltipModel) {\n                        // Tooltip Element\n                        var tooltipEl = document.getElementById('chartjs-tooltip');\n\n                        // Create element on first render\n                        if (!tooltipEl) {\n                            tooltipEl = document.createElement('div');\n                            tooltipEl.id = 'chartjs-tooltip';\n                            tooltipEl.innerHTML = '<div class=\"chartjs-tooltip-container\"></div>';\n                            document.body.appendChild(tooltipEl);\n                        }\n\n                        tooltipEl.classList.add('formie-widget-chart-tooltip');\n\n                        // Hide if no tooltip\n                        if (tooltipModel.opacity === 0) {\n                            tooltipEl.style.opacity = 0;\n                            return;\n                        }\n\n                        // Set caret Position\n                        tooltipEl.classList.remove('above', 'below', 'no-transform');\n                        if (tooltipModel.yAlign) {\n                            tooltipEl.classList.add(tooltipModel.yAlign);\n                        } else {\n                            tooltipEl.classList.add('no-transform');\n                        }\n\n                        function getBody(bodyItem) {\n                            return bodyItem.lines;\n                        }\n\n                        // Set Text\n                        if (tooltipModel.body) {\n                            var titleLines = tooltipModel.title || [];\n                            var bodyLines = tooltipModel.body.map(getBody);\n                            var { dataPoints } = tooltipModel;\n\n                            var innerHtml = '<div>';\n\n                            titleLines.forEach((title) => {\n                                if (title && title != 'null') {\n                                    innerHtml += '<h3>' + title + '</h3>';\n                                }\n                            });\n\n                            bodyLines.forEach((body, i) => {\n                                var colors = tooltipModel.labelColors[i];\n                                var style = 'background:' + colors.backgroundColor;\n                                style += '; border-color:' + colors.borderColor;\n                                var span = '<span class=\"legend-dot\" style=\"' + style + '\"></span>';\n                                innerHtml += '<div class=\"formie-widget-chart-tooltip-items\">' + span + '<span>' + body + '</span>' + '</div>';\n                            });\n                            innerHtml += '</div>';\n\n                            var tableRoot = tooltipEl.querySelector('.chartjs-tooltip-container');\n                            tableRoot.innerHTML = innerHtml;\n                        }\n\n                        // `this` will be the overall tooltip\n                        var position = this._chart.canvas.getBoundingClientRect();\n\n                        // Display, position, and set styles for font\n                        tooltipEl.style.opacity = 1;\n                        tooltipEl.style.position = 'absolute';\n                        tooltipEl.style.left = position.left + window.pageXOffset + tooltipModel.caretX + 'px';\n                        tooltipEl.style.top = position.top + window.pageYOffset + tooltipModel.caretY + 'px';\n                        tooltipEl.style.fontFamily = tooltipModel._bodyFontFamily;\n                        tooltipEl.style.fontSize = tooltipModel.bodyFontSize + 'px';\n                        tooltipEl.style.fontStyle = tooltipModel._bodyFontStyle;\n                        tooltipEl.style.pointerEvents = 'none';\n                    },\n                },\n            },\n        },\n        line: {\n            options: {\n                aspectRatio: 2.5,\n                legend: {\n                    labels: {\n                        boxWidth: 6,\n                    },\n                },\n                tooltips: {\n                    intersect: false,\n                },\n            },\n        },\n        doughnut: {\n            options: {\n                aspectRatio: 1,\n                cutoutPercentage: 60,\n                legend: {\n                    position: 'bottom',\n                },\n            },\n        },\n    },\n\n    /**\n     * Default dataset options key'd by chart type\n     */\n    datasetDefaults: {\n        general: {\n\n        },\n        doughnut: {\n            backgroundColor: Craft.Formie.ChartColors.doughnutColors(),\n            borderColor: Craft.Formie.ChartColors.doughnutColors(),\n            borderWidth: 0,\n        },\n        line: {\n            borderWidth: 3,\n            pointRadius: 2,\n            pointHitRadius: 4,\n            lineTension: 0,\n        },\n    },\n\n    /**\n     * Global defaults\n     */\n    globalDefaults: {\n        defaultFontFamily: 'system-ui, BlinkMacSystemFont, -apple-system, \\'Segoe UI\\', \\'Roboto\\', \\'Oxygen\\', \\'Ubuntu\\', \\'Cantarell\\', \\'Fira Sans\\', \\'Droid Sans\\', \\'Helvetica Neue\\', sans-serif',\n    },\n\n    /**\n     * RTL options\n     * These are separated from the defaults so they are forced\n     */\n    rtl: false,\n    rtlDefaults: {\n        options: {\n            legend: {\n                rtl: true,\n            },\n            tooltips: {\n                rtl: true,\n            },\n        },\n    },\n\n    chart: null,\n\n    init(id, settings) {\n        moment.locale(window.formieCurrentLocale);\n\n        this.$container = $('#' + id);\n        this.rtl = $('body').hasClass('rtl');\n\n        if (this.$container.length && settings.chart) {\n            var options = this.getDefaultOptions(settings.chart.type);\n\n            // Merge user defined options with defaults\n            options = deepmerge(options, settings.chart);\n\n            options = this.mergeRtlOptions(options);\n\n            if (options.data && options.data.datasets && options.data.datasets.length) {\n                options.data.datasets = this.mergeDatasetsDefaults(options.data.datasets, options.type);\n            }\n\n            this.renderChart(options);\n        }\n    },\n\n    getDefaultOptions(type) {\n        var options = this.defaults.general;\n\n        if (this.defaults[type]) {\n            options = deepmerge(options, this.defaults[type]);\n        }\n\n        return options;\n    },\n\n    mergeDatasetsDefaults(datasets, type) {\n        if (this.datasetDefaults[type] == undefined) {\n            return datasets;\n        }\n\n        var mergedDatasets = [];\n        var colorsIndex = 0;\n        var tmp;\n\n        for (var i = 0; i < datasets.length; i++) {\n            tmp = deepmerge(this.datasetDefaults[type], datasets[i]);\n\n            // Loop through colours for line charts\n            if (type == 'line') {\n                tmp = deepmerge(tmp, {\n                    backgroundColor: Craft.Formie.ChartColors.bgColors()[colorsIndex],\n                    borderColor: Craft.Formie.ChartColors.borderColors()[colorsIndex],\n                    pointBackgroundColor: Craft.Formie.ChartColors.borderColors()[colorsIndex],\n                });\n            }\n\n            mergedDatasets.push(tmp);\n\n            colorsIndex++;\n            if (colorsIndex == Craft.Formie.ChartColors.bgColors().length) {\n                colorsIndex = 0;\n            }\n        }\n\n        return mergedDatasets;\n    },\n\n    mergeRtlOptions(options) {\n        if (!this.rtl) {\n            return options;\n        }\n\n        return deepmerge(options, this.rtlDefaults);\n    },\n\n    renderChart(options) {\n        Chart.defaults.global = deepmerge(Chart.defaults.global, this.globalDefaults);\n\n        this.chart = new Chart(this.$container, options);\n    },\n});\n"],"names":["value","index","values","event","label","tooltipItems","data","title","format","allFirstOfMonth","tooltipItem","tooltipModel","tooltipEl","getBody","bodyItem","titleLines","bodyLines","innerHtml","body","i","colors","style","span","tableRoot","position","id","settings","options","type","datasets","mergedDatasets","colorsIndex","tmp"],"mappings":"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"}